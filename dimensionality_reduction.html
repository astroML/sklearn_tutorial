

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Dimensionality Reduction of Astronomical Spectra &mdash; Machine Learning for Astronomical Data Analysis</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'Scipy2012',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Machine Learning for Astronomical Data Analysis" href="index.html" />
    <link rel="next" title="7. Exercises: Taking it a step further" href="exercises.html" />
    <link rel="prev" title="5. Regression: Photometric Redshifts of Galaxies" href="regression.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22606712-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="index.html">
            <img src="_static/scikit-learn-logo-small.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
          
	    <li><a href="general_concepts.html">Machine learning 101</a></li>
            <li><a href="classification.html">Classification</a></li>
            <li><a href="regression.html">Regression</a></li>
            <li><a href="exercises.html">Exercises</a></li>
            <li><a href="auto_examples/index.html">Examples</a></li>
          
	  
       </ul>

<!--
<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
  google.load('search', '1', {language : 'en'});
  google.setOnLoadCallback(function() {
    var customSearchControl = new google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    var options = new google.search.DrawOptions();
    options.setAutoComplete(true);
    customSearchControl.draw('cse', options);
  }, true);
</script>

</div>
-->
          </div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	   <div class="rel rellarge">
	     
	<!-- XXX: when we have a 'module index' that appears in the link
	     bar, we will need to use the following ugly hack to avoid it
	     rellinks[1:]|reverse
	    -->
	<div class="rellink">
	<a href="regression.html" title="5. Regression: Photometric Redshifts of Galaxies"
	    accesskey="P">Previous
	    <br>
	    <span class="smallrellink">
	    5. Regression: P...
	    </span>
	    <span class="hiddenrellink">
	    5. Regression: Photometric Redshifts of Galaxies
	    </span>
	    
	    </a>
	</div>
	    <div class="spacer">
	    &nbsp;
	    </div>
	
	<div class="rellink">
	<a href="exercises.html" title="7. Exercises: Taking it a step further"
	    accesskey="N">Next
	    <br>
	    <span class="smallrellink">
	    7. Exercises: Ta...
	    </span>
	    <span class="hiddenrellink">
	    7. Exercises: Taking it a step further
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
    </div>
    <h3>This page</h3>
	<ul>
<li><a class="reference internal" href="#">6. Dimensionality Reduction of Astronomical Spectra</a><ul>
<li><a class="reference internal" href="#sdss-spectral-data">6.1. SDSS Spectral Data</a></li>
<li><a class="reference internal" href="#principal-component-analysis">6.2. Principal Component Analysis</a></li>
<li><a class="reference internal" href="#references">6.3. References</a></li>
</ul>
</li>
</ul>

    
    <h3>Giving credit</h3>
    <p>Please consider <a href="AUTHORS.html#citing">citing the 
    scikit-learn</a> if you use it.</p>

    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dimensionality-reduction-of-astronomical-spectra">
<h1>6. Dimensionality Reduction of Astronomical Spectra<a class="headerlink" href="#dimensionality-reduction-of-astronomical-spectra" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://www.sdss.org/">Sloan Digital Sky Survey</a> is a photometric and
spectroscopic survey which has operated since the year 2000, and has resulted
in an unprecedented astronomical database.  The database contains
photometric observations like those we explored in the previous sections,
but also includes a large number of spectra of various objects.  These spectra
are <img class="math" src="_images/math/174fadd07fd54c9afe288e96558c92e0c1da733a.png" alt="n"/>-dimensional data vectors (generally, <img class="math" src="_images/math/5a1d0234768670d9ce82e445399508f0faf159f0.png" alt="n \approx 4000"/>)
for each observed object, where each observation in the vector
measures the flux of a particular wavelength of light.</p>
<p>Because of the large dimensionality of this data, visualization of the dataset
becomes very challenging.  This is where unsupervised dimensionality
reduction methods can be useful.  One of the most commonly used dimensionality
reduction methods in astronomy is
<a class="reference external" href="http://scikit-learn.org/stable/modules/decompositions.html#principal-component-analysis-pca">Principal Component Analysis (PCA)</a>.  We won&#8217;t
go through the mathematical details here, but PCA essentially seeks dimensions
of the input data which contain the bulk of the variability present in the
data.  The model has this form:</p>
<div class="math">
<p><img src="_images/math/3d4f7886b26903f003c327eea9d1e8d90615f66c.png" alt="\vec{x_i} = \vec{\mu} + \sum_{j = 1}^n a_{ij} \vec{v_j}"/></p>
</div><p>Here <img class="math" src="_images/math/66edefac2140ba9e9b74e8d15fdc7bfc4a2c7cf2.png" alt="\vec{x_i}"/> represents an individual spectrum.  <img class="math" src="_images/math/60765d7d0aa2d7c74923574f516f611c55a25e1f.png" alt="\vec{\mu}"/>
is the mean spectrum for the dataset.  The remaining term encodes the
contributions of each of the <cite>eigenvectors</cite> <img class="math" src="_images/math/6337ebeaa802c813cd78fb1c50714607f2744a51.png" alt="\vec{v_j}"/>.  The
eigenvectors are generally arranged so that those with the smallest <img class="math" src="_images/math/8122aa89ea6e80784c6513d22787ad86e36ad0cc.png" alt="j"/>
contain the most signal-to-noise, and are the most important vectors in
reconstructing the spectra.  For this reason, truncating the sum at some
<img class="math" src="_images/math/9b2142770fa24b44536073e58e97ca948a989965.png" alt="m &lt; n"/> can still result in a faithful representation of the input.</p>
<p>For astronomical spectra, the result is that the first few coefficientts
<img class="math" src="_images/math/d6b159fdba4b71ff0eb9caee9a10fb34ebfcaad8.png" alt="a_{ij}"/> of each spectrum <img class="math" src="_images/math/66edefac2140ba9e9b74e8d15fdc7bfc4a2c7cf2.png" alt="\vec{x_i}"/> encode a good low-dimensional
representation of the spectrum.  We&#8217;ll use this fact to visualize this data
in a meaningful way.</p>
<div class="section" id="sdss-spectral-data">
<h2>6.1. SDSS Spectral Data<a class="headerlink" href="#sdss-spectral-data" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The information in this section is available in an interactive notebook
<a class="reference download internal" href="_downloads/09_dimensionality_example.ipynb"><tt class="xref download docutils literal"><span class="pre">09_dimensionality_example.ipynb</span></tt></a>,
which can be viewed using <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/htmlnotebook.html">iPython notebook</a>.    An online static view can
be seen <a class="reference external" href="http://nbviewer.ipython.org/url/astroml.github.com/sklearn_tutorial/_downloads/09_dimensionality_example.ipynb">here</a>.</p>
</div>
<p>In the directory <tt class="docutils literal"><span class="pre">$TUTORIAL_HOME/data/sdss_spectra/</span></tt>, you&#8217;ll find the script
which fetches a set of spectra from the Sloan Digital Sky Survey.  Each
individual spectrum is at a particular redshift, and can have data missing
in certain spectral regions.  So that this doesn&#8217;t affect our analysis, the
spectra have been de-redshifted and the gaps have been filled using the
PCA-based algorithm described in <a class="footnote-reference" href="#id3" id="id1">[1]</a>.  In the process of shifting and
gap-filling, the spectra have been down-sampled
so that the number of attributes is <img class="math" src="_images/math/1712c68d8307d6b4c34a16a8cab9eea64f2c8094.png" alt="n = 1000"/>.</p>
<p>Once the dataset is downloaded, it can be read-in as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;spec4000_corrected.npz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">files</span>
<span class="go">[&#39;y&#39;, &#39;X&#39;, &#39;z&#39;, &#39;wavelengths&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4000, 1000)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;labels&#39;</span><span class="p">]</span>
<span class="go">[&#39;unknown&#39; &#39;star&#39; &#39;absorption galaxy&#39; &#39;galaxy&#39; &#39;emission galaxy&#39;</span>
<span class="go"> &#39;narrow-line QSO&#39; &#39;broad-line QSO&#39; &#39;sky&#39; &#39;Hi-z QSO&#39; &#39;Late-type star&#39;]</span>
</pre></div>
</div>
<p>The variable <tt class="docutils literal"><span class="pre">X</span></tt> contains 4000 spectra, each with 1000 attributes.  In
addition, the file includes a classification code <tt class="docutils literal"><span class="pre">y</span></tt>, and redshift <tt class="docutils literal"><span class="pre">z</span></tt>
for each spectrum, and an array <tt class="docutils literal"><span class="pre">wavelengths</span></tt> which can aid in plotting
spectra.  Let&#8217;s plot a few of these to see what they look like, making sure
to choose a representative of each of the interesting classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_spectral_types</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;wavelengths&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;labels&#39;</span><span class="p">]</span>

<span class="gp">... </span>    <span class="k">for</span> <span class="n">i_class</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="n">i_class</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>        <span class="n">l</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i_class</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">pl</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">6800</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i_class</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">i_class</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;flux + offset&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Sample of Spectra&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>calling <tt class="docutils literal"><span class="pre">plot_spectral_types(data)</span></tt> gives the following figure:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_sdss_specPCA.html"><img alt="_images/plot_sdss_specPCA_1.png" src="_images/plot_sdss_specPCA_1.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">A sample from among the most interesting classes of object.  These objects
are classified based on their emission and absorption characteristics.</p>
</div>
<p>There are 4000 spectra in this file, each with 1000 attributes.  Visualizing
a dataset of this size can be very difficult.  We could plot all 4000 spectra
as we did above, but the plot would quickly become too complicated.  As a
first step, it might be helpful to ask what the average spectrum
looks like.  To do this, we&#8217;ll plot the mean, but first we&#8217;ll normalize the
spectra.  Because the spectra represent galaxies at distances that range
over several hundreds of light-years, their total flux varies greatly.
Thus it will help if we normalize the spectra.  For this we&#8217;ll use the
scikit-learn preprocessing module.  We&#8217;ll then plot both the mean and standard
deviation to give us an idea of the data we&#8217;re working with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_mean_std</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;wavelengths&#39;</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">X</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">mu</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">std</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">std</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#CCCCCC&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">wavelengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;scaled flux&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Mean Spectrum&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <tt class="docutils literal"><span class="pre">plot_mean_std(data)</span></tt> gives the following figure:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_sdss_specPCA.html"><img alt="_images/plot_sdss_specPCA_2.png" src="_images/plot_sdss_specPCA_2.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">The mean and standard deviation of the normalized spectra.  Some of the
largest variation is found at wavelengths at which Hydrogen absorbs and
emits photons (Hydrogen is by far the most abundant atom in the universe).
For example, the line at 6563 is known as Hydrogen-<img class="math" src="_images/math/10f32377ac67d94f764f12a15ea987e88c85d3e1.png" alt="\alpha"/>, and is
often seen in emission (spiking up) in quasars and other active galaxies.</p>
</div>
<p>The interesting part of the data is in the gray shaded regions: how do spectra
vary from the mean, and how can this variation tell us about their
physical properties?
One option to visualize this would be to scatter-plot random pairs of
observations from each spectrum.
We&#8217;ll create a function to visualize this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_random_projection</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rseed</span><span class="o">=</span><span class="mi">25255</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c"># rseed is chosen to emphasize correlation</span>
<span class="gp">... </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">rseed</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c"># create a formatter which works for our labels</span>
<span class="gp">... </span>    <span class="n">format</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">X</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;labels&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;wavelengths&#39;</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="n">i1</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">i2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">vmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wavelength = </span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;wavelength = </span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">wavelengths</span><span class="p">[</span><span class="n">i2</span><span class="p">])</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Random Pair of Spectra Bins&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling <tt class="docutils literal"><span class="pre">plot_random_projection(data)</span></tt> gives the following plot:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_sdss_specPCA.html"><img alt="_images/plot_sdss_specPCA_3.png" src="_images/plot_sdss_specPCA_3.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">A scatter-plot of a random pair of observations from the data.  These show
a clear correlation.</p>
</div>
<p>There is a clear correlation between these two measurements.  That is, if you
know the value of one, then you could quite accurately predict the value of
the other.  This shows us that some of the spectral bins do not add much
information, and can be ignored.  One could imagine proceeding by trial and
error, plotting pairs of points and seeing which ones provide the most
interesting information, but this would be very tedious.  Instead, we can
use an automated technique for dimensionality reduction, one well-known example
of which is Principal Component Analysis.</p>
</div>
<div class="section" id="principal-component-analysis">
<h2>6.2. Principal Component Analysis<a class="headerlink" href="#principal-component-analysis" title="Permalink to this headline">¶</a></h2>
<p>Principal Component Analysis (PCA) is an often-used tool in astronomy
and other data-intensive sciences.  In a
sense, it automates the trial-and-error process discussed in the previous
section, and finds
the most interesting linear combinations of attributes, so that
high-dimensional data can be visualized in a 2D or 3D plot.  Scikit-learn
has methods to compute PCA and several variants.  Classic PCA
(<a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html#sklearn.decomposition.PCA" title="(in scikit-learn v0.12)"><tt class="xref py py-class docutils literal"><span class="pre">sklearn.decomposition.PCA</span></tt></a>) is based on
an eigenvalue decomposition of the data covariance, so that for <img class="math" src="_images/math/fc97ef67268cd4e91bacdf12b8901d7036c9a056.png" alt="N"/>
points, the computational cost grows as <img class="math" src="_images/math/c0f39b210b8d93d5710751f1350edf622633d5c0.png" alt="\mathcal{O}[N^3]"/>.  This means
that for large datasets like the current one, the fit can be very slow.  You
can try it as follows, but the computation may take up to several minutes
for this dataset:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_projected</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c"># warning: this takes a long time!</span>
</pre></div>
</div>
<p>Fortunately, scikit-learn has an alternative method that is much faster.
The speed comes at a price: it is based on random projections, so the results
are not as robust as the normal method.  But for tasks such as ours where we
are seeking only a few of a large number of eigenvectors, it performs
fairly well.  To keep our results consistent between runs, we&#8217;ll explicitly
set the random seed for the fit.  You should repeat this with several different
random seeds to convince yourself that the results are consistent:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">RandomizedPCA</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rpca</span> <span class="o">=</span> <span class="n">RandomizedPCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_proj</span> <span class="o">=</span> <span class="n">rpca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_proj</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4000, 4)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">X_proj</span></tt> is now a reduced-dimension representation of <tt class="docutils literal"><span class="pre">X</span></tt>, where the
lower-index columns are the most important dimensions.  We can visualize
the spectra now using the first two columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_PCA_projection</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rpca</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c"># create a formatter which works for our labels</span>
<span class="gp">... </span>    <span class="n">labels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;labels&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">format</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">X_proj</span> <span class="o">=</span> <span class="n">rpca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_proj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_proj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;coefficient 1&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;coefficient 2&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;PCA projection of Spectra&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling this function as <tt class="docutils literal"><span class="pre">plot_PCA_projection(data,</span> <span class="pre">rpca)</span></tt> gives the
following plot:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_sdss_specPCA.html"><img alt="_images/plot_sdss_specPCA_4.png" src="_images/plot_sdss_specPCA_4.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">A scatter-plot of the first two principal components of the spectra.</p>
</div>
<p>We now have a two-dimensional visualization, but what does this tell us?
Looking at the PCA model in the equation above, we see that each component
is associated with an eigenvector, and this plot is showing <img class="math" src="_images/math/8a01b65b7b9b4e20632de5ee2e00f86c32a65ddd.png" alt="a_{i1}"/>
and <img class="math" src="_images/math/03415e479bb4c61161cef1ddaf0d32fd5e3c9458.png" alt="a_{i2}"/> where</p>
<div class="math">
<p><img src="_images/math/3946e17d510cdad0bfbee40a4c238bb12fc38ded.png" alt="\vec{s_i} \approx \vec{\mu} + a_{i1}\vec{v_1} + a_{i2}\vec{v_2}"/></p>
</div><p>Visualizing the <cite>eigenvectors</cite> <img class="math" src="_images/math/6337ebeaa802c813cd78fb1c50714607f2744a51.png" alt="\vec{v_j}"/> can give insight into what
these components mean:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">plot_eigenvectors</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rpca</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;wavelengths&#39;</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">l</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">rpca</span><span class="o">.</span><span class="n">mean_</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">7000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.16</span><span class="p">,</span> <span class="s">&quot;mean&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">l</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">rpca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">c</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">pl</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">7000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span> <span class="o">+</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="s">&quot;component </span><span class="si">%i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wavelength (Angstroms)&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;scaled flux + offset&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">pl</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Mean Spectrum and Eigen-spectra&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calling this function as <tt class="docutils literal"><span class="pre">plot_eivenvectors(data,</span> <span class="pre">rpca)</span></tt> gives the
following plot:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="auto_examples/plot_sdss_specPCA.html"><img alt="_images/plot_sdss_specPCA_5.png" src="_images/plot_sdss_specPCA_5.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption">The mean spectrum and the first four eigenvectors of the spectral data.</p>
</div>
<p>We see that the first eigenspectrum (component 1) tells us about the relative
difference in flux between low wavelengths and high wavelengths - that is, the
color of the spectrum.  Component 2 tells us a lot about the emission and
absorption characteristics in the various lines, and also in the so-called
&#8220;4000 angstrom break&#8221; due to Hydrogen absorption.  Detailed analysis of these
components and eigenspectra can lead to much physical insight about the
galaxies in the fit (See, for example <a class="footnote-reference" href="#id3" id="id2">[1]</a>).</p>
<p>Nevertheless, there are some weaknesses here.  First of all, PCA does not
do a good job of separating out galaxies with different emission
characteristics.  We&#8217;d hope for a projection which reflects the fact that
narrow spectral features are very important in the classification.  PCA
does not do this.  Later, in <a class="reference internal" href="exercises.html#astro-exercise-3"><em>Exercise 3</em></a>,
we&#8217;ll explore some alternative
nonlinear dimensionality reduction techniques which will address this
deficiency of PCA.</p>
</div>
<div class="section" id="references">
<h2>6.3. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> C.W. Yip et al.  Spectral Classification of Quasars in the
Sloan Digital Sky Survey: Eigenspectra, Redshift, and Luminosity Effects.
Astronomical Journal 128:6, 2004.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; scikit-learn developers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3. Design by <a href="http://webylimonada.com">Web y Limonada</a>.
    <span style="padding-left: 5ex;">
    <a href="_sources/dimensionality_reduction.txt"
	    rel="nofollow">Show this page source</a>
    </span>
    </div>
     <div class="rel rellarge">
    
	<!-- XXX: when we have a 'module index' that appears in the link
	     bar, we will need to use the following ugly hack to avoid it
	rellinks[1:]|reverse
	-->
    <div class="buttonPrevious">
      <a href="regression.html">
        Previous
      </a>  
    </div>
    <div class="buttonNext">
      <a href="exercises.html">
        Next
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#FF9C34');
           },
           function () {
               $(this).css('background-color', '#A7D6E2');
           }
       );
     </script>
  </body>
</html>